// http://craig.is/making/rainbows
window.Rainbow=function(){function k(a,b){var c=a.getAttribute&&a.getAttribute(b)||null;if(!c){var d=a.attributes,e=d.length,f;for(f=0;f<e;++f)b[f].nodeName===b&&(c=b[f].nodeValue)}return c}function l(a,b){a.className+=a.className?" "+b:b}function m(a,b){return(" "+a.className+" ").indexOf(" "+b+" ")>-1}function n(a,b,c,d){return c>=a&&c<b?!0:d>a&&d<b}function o(a,b,c,d){return c==a&&d==b?!1:c<=a&&d>=b}function p(c,d){for(var f in b[e]){f=parseInt(f,10),o(f,b[e][f],c,d)&&(delete b[e][f],delete a[e][f]);if(n(f,b[e][f],c,d))return!0}return!1}function q(a,b){return'<span class="'+a.replace(/\./g," ")+(i?" "+i:"")+'">'+b+"</span>"}function r(a,b){var c=0,d;for(d=1;d<b;++d)a[d]&&(c+=a[d].length);return c}function s(c,d,f,h){var i=c.exec(f);if(!i)return h();++g,!d.name&&d.matches[0]&&(d.name=d.matches[0],delete d.matches[0]);var j=i[0],k=i.index,l=i[0].length+k,m=function(){var a=function(){s(c,d,f,h)};return g%100>0?a():setTimeout(a,0)};if(p(k,l))return m();var n=function(c){d.name&&(c=q(d.name,c)),a[e]||(a[e]={},b[e]={}),a[e][k]={replace:i[0],"with":c},b[e][k]=l,m()},o=w(d.matches),t=function(a,b,c){if(a>=b.length)return c(j);var e=function(){t(++a,b,c)},f=i[b[a]];if(!f)return e();var g=d.matches[b[a]],h=g.language;if(h)return z(f,h,function(a){j=j.replace(f,a),e()});if(typeof g=="object")return x(f,g.length?g:[g],function(a){j=j.replace(f,a),e()});var k=r(i,b[a]);j=v(k,f,q(g,f),j),e()};t(0,o,n)}function t(a){return d[a]}function u(a){var b=c[a]||[],d=c[f]||[];return t(a)?b:b.concat(d)}function v(a,b,c,d){var e=d.substr(a);return d.substr(0,a)+e.replace(b,c)}function w(a){var b=[],c,d;for(var e in a)a.hasOwnProperty(e)&&b.push(e);return b.sort(function(a,b){return b-a})}function x(c,d,f){function g(d,h){if(h<d.length)return s(d[h].pattern,d[h],c,function(){g(d,++h)});y(c,function(c){delete a[e],delete b[e],--e,f(c)})}++e,g(d,0)}function y(b,c){function d(b,c,f,g){if(f<c.length){++h;var i=c[f],j=a[e][i];b=v(i,j.replace,j["with"],b);var k=function(){d(b,c,++f,g)};return h%250>0?k():setTimeout(k,0)}g(b)}var f=w(a[e]);d(b,f,0,c)}function z(a,b,c){var d=u(b);x(a,d,function(a){c(a)})}function A(c,d,e){if(d<c.length){var f=k(c[d],"data-language")||k(c[d].parentNode,"data-language");return!m(c[d],"rainbow")&&f?(f=f.toLowerCase(),l(c[d],"rainbow"),z(c[d].innerHTML,f,function(g){c[d].innerHTML=g,a={},b={},j&&j(c[d],f),setTimeout(function(){A(c,++d,e)},0)})):A(c,++d,e)}e&&e()}function B(a,b){var c=(a||document).getElementsByTagName("pre"),d=(a||document).getElementsByTagName("code"),e,f=[];for(e=0;e<d.length;++e)f.push(d[e]);for(e=0;e<c.length;++e)c[e].getElementsByTagName("code").length||f.push(c[e]);A(f,0,b)}var a={},b={},c={},d={},e=0,f=0,g=0,h=0,i,j;return{extend:function(a,b,e){arguments.length==1&&(b=a,a=f),d[a]=e,c[a]=b.concat(c[a]||[])},onHighlight:function(a){j=a},addClass:function(a){i=a},color:function(){if(typeof arguments[0]=="string")return z(arguments[0],arguments[1],arguments[2]);if(typeof arguments[0]=="function")return B(null,arguments[0]);B(arguments[0]instanceof Event?null:arguments[0],arguments[1])}}}(),Rainbow.extend([{matches:{1:{name:"keyword.operator",pattern:/\=/g},2:"string"},pattern:/(\(|\s|\[|\=)(('|")[\s\S]*?(\3))/gm},{name:"comment",pattern:/\/\*[\s\S]*?\*\/|(\/\/|\#)[\s\S]*?$/gm},{name:"integer",pattern:/\b(0x[\da-f]+|\d+)\b/g},{name:"constant",pattern:/\b[A-Z0-9_]{2,}\b/g},{matches:{1:"keyword"},pattern:/\b(and|array|as|bool(ean)?|c(atch|har|lass|onst)|d(ef|elete|ie|o(uble)?)|e(cho|lse(if)?|xit|xtends)|f(inally|loat|or(each)?|unction)|global|if|import|int(eger)?|long|new|object|or|pr(int|ivate|otected)|public|return|self|st(ring|ruct|atic)|switch|th(en|is|row)|try|(un)?signed|var|void|while)(?=\(|\b)/g},{name:"constant.language",pattern:/true|false|null/g},{name:"keyword.operator",pattern:/\+|\!|\-|&(gt|lt|amp);|\||\*|\=/g},{matches:{1:"function.call"},pattern:/(\w+?)(?=\()/g},{matches:{1:"keyword",2:"meta.function-call"},pattern:/(function)\s(.*?)(?=\()/g}]),function(){if(window.addEventListener)return window.addEventListener("load",Rainbow.color,!1);window.attachEvent("onload",Rainbow.color)}(),Rainbow.onHighlight=Rainbow.onHighlight,Rainbow.addClass=Rainbow.addClass,Rainbow.color=Rainbow.color,Rainbow.extend("javascript",[{name:"selector",pattern:/\s\$(?=\.|\()/g},{name:"support",pattern:/\b(window|document)\b/g},{matches:{1:"support.property"},pattern:/\.(length|node(Name|Value))\b/g},{matches:{1:"support.function"},pattern:/(setTimeout|setInterval)(?=\()/g},{matches:{1:"support.method"},pattern:/\.(getAttribute|push|getElementById|getElementsByClassName|log|setTimeout|setInterval)(?=\()/g},{name:"constant.regex",matches:{1:"support.regex.open",2:{name:"constant.regex.escape",pattern:/\\(.){1}/g},3:"support.regex.close",4:"support.regex.modifier"},pattern:/(\/)(.+)(\/)([igm]{0,3})/g},{name:"meta.function-call",pattern:/(\w+)(?=:\s{0,}function)/g},{matches:{2:[{name:"string",pattern:/('|")(.*?)(\1)/g},{name:"meta.script-tag",pattern:/(\w+)/g}]},pattern:/(&lt;\/?)(script(.*?))(&gt;)/g}])
